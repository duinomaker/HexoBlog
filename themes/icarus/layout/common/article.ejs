<% post = post(); %>
<% if (!index && post.redirect) { %>
    <script type="text/javascript">document.location = "<%= post.canonical_url.slice(22) %>";</script>
<% } else { %>
<div class="card">
    <% if (has_thumbnail(post)) { %>
    <div class="card-image">
        <%- index ? '<a href="' + url_for(post.link ? post.link : post.path) + '"' : '<span ' %> class="image is-7by1">
        <img class="thumbnail" src="<%= get_thumbnail(post) %>" alt="<%= post.title %>">
        <%- index ? '</a>' : '</span>' %>
    </div>
    <% } %>
    <div class="card-content article <%= post.hasOwnProperty('direction') ? post.direction : '' %>">
        <% if (post.layout != 'page') { %>
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <% if (index && post.pinned) { %>
                <span class="level-item has-text-grey"><i class="fas fa-thumbtack"></i>&nbsp;pinned</span>
                <% } else { %>
                <time class="level-item has-text-grey"
                    datetime="<%= date_xml(post.date) %>"><%= date(post.date) %></time>
                <% } %>
                <% if (post.categories && post.categories.length) { %>
                <div class="level-item">
                    <%- list_categories(post.categories, {
                    class: 'has-link-grey ',
                    show_count: false,
                    style: 'none',
                    separator: '&nbsp;<span class="has-text-grey">/</span>&nbsp;'
                }) %>
                </div>
                <% } %>
                <span class="level-item has-text-grey">
                    <i class="fas fa-file-word"></i>&nbsp;<%= wordcount(post.content) %>&nbsp;words
                </span>
                <!-- <% if (!has_config('article.readtime') || get_config('article.readtime') === true) { %>
                <span class="level-item has-text-grey">
                    <% const words = word_count(post._content); %>
                    <% const time = duration((words / 150.0) * 60, 'seconds') %>
                    <%= `${ time.locale(get_config('language', 'en')).humanize() } ${ __('article.read')} (${ __('article.about') } ${ words } ${ __('article.words') })` %>
                </span>
                <% } %> -->
                <!-- <% if (!index && (has_config('plugins.busuanzi') ? get_config('plugins.busuanzi') : false)) { %>
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <%- _p('plugin.visit', '<span id="busuanzi_value_page_pv">0</span>') %>
                </span>
                <% } %> -->
            </div>
        </div>
        <% } %>
        <% if (!post.nocontent) { %>
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal <%= post.content_style %>">
            <% if (index) { %>
            <a class="has-link-black-ter" href="<%- post.redirect ? post.canonical_url.slice(22) : url_for(post.link ? post.link : post.path) %>"><%= post.title %></a>
            <% } else { %>
            <%= post.title %>
            <% } %>
        </h1>
        <% } %>
        <% if (!post.nocontent) { %>
            <div class="content has-math <%= post.content_style %>">
            <% if (post.license_lang == 'en') { %>
            <style>strong{font-weight:500;}</style>
            <% } %>
            <% if (post.has_serif || post.content_style == 'serif') { %>
            <%- _css(fontcdn('Alegreya:400,italic,500,500italic')) %>
            <% if (post.content_style == 'serif') { %>
            <style>em{margin-left:0;margin-right:0;}.article .content{font-size:1.2rem;}</style>
            <% } %>
            <% } %>
        <% } %>
            <%- index && post.excerpt ? post.excerpt : post.content %>
        <% if (!post.nocontent) { %>
            </div>
        <% } %>
        <% if (!index && (post.layout == 'post' || post.license != null)) { %>
        <div class="copyright">
            <% if (post.license != 'notrust') { %>
                <% if (post.license_lang == 'en') { %>
                <p><strong class="rigid" style="font-weight:500;">Author:&nbsp;</strong><a rel="author" href="https://duinomaker.top/">duinomaker</a></p>
                <p><strong class="rigid" style="font-weight:500;">Permalink:&nbsp;</strong><a href="<%= url_for(post.link ? post.link : post.path) %>" title="<%= post.title %>"><%- 'https://duinomaker.top' + url_for(post.link ? post.link : post.path) %></a></p>
                <% } else { %>
                <p><strong class="rigid">本文作者：</strong><a rel="author" href="https://duinomaker.top/">duinomaker</a></p>
                <p><strong class="rigid">本文链接：</strong><a href="<%= url_for(post.link ? post.link : post.path) %>" title="<%= post.title %>"><%- 'https://duinomaker.top' + url_for(post.link ? post.link : post.path) %></a></p>
                <% } %>
            <% } %>
            <% if (post.license == 'noshare') { %>
                <p><strong class="rigid">版权声明：</strong>作者对该作品保留所有权利，未经允许禁止转载。</p>
            <% } else if (post.license == 'notrust') { %>
                <p><strong class="rigid">免责声明：</strong>该页面内容来自网络，未经网站管理者审核、不代表本网站及其管理者的观点或立场。本网站一概毋须以任何方式就任何信息传递或传送的失误、不准确或错误对用户或任何其他人士负任何直接或间接的责任。</p>
            <% } else if (post.license == 'by-sa') { %>
                <p><strong class="rigid">版权声明：</strong>与本博客中的大部分作品不同，本作品采用<a
                rel="license noopener" href="https://creativecommons.org/licenses/by-sa/4.0/"
                title="Creative Commons Attribution-ShareAlike 4.0 International License" target="_blank">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可，转载请注明出处。</p>
            <% } else if (post.license_lang == 'en'){ %>
                <p><strong class="rigid" style="font-weight:500;">Copyright:&nbsp;</strong>This work is licensed under a <a
                rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
            <% } else { %>
                <p><strong class="rigid">版权声明：</strong>如非特别声明，本博客中的所有作品（包括本作品）均采用<a
                rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可，非商业性转载请注明出处，商业性转载请联系作者获得授权。</p>
            <% } %>
        </div>
        <% } %>
        <% if (!index && post.tags && post.tags.length) { %>
        <div class="article-tags is-size-7 is-uppercase" style="word-wrap: anywhere;">
            <span class="is-size-6 has-mr-8 has-text-grey rigid">#</span><%- list_tags(post.tags, {
                class: 'has-link-grey has-mr-6 rigid',
                show_count: false,
                style: '',
                separator: '&#8203;<span class="is-size-6 has-mr-8 has-text-grey rigid">#</span>'
            }) %>
        </div>
        <% } %>
        <!-- <% if (index && post.excerpt && !post.redirect) { %>
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                    <a class="button is-size-7 is-light"
                        href="<%- post.redirect ? post.canonical_url.slice(22) : url_for(post.path) + '#more' %>"><%= __('article.more') %></a>
                </div>
            </div>
        </div>
        <% } %> -->
        <% if (!index && has_config('share.type')) { %>
        <%- _partial('share/' + get_config('share.type')) %>
        <% } %>
    </div>
</div>

<% const services = has_config('donate') ? get_config('donate') : []; %>
<% if (!index && services.length > 0) { %>
<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered"><%= __('donate.title') %></h3>
        <div class="buttons is-centered">
            <% for (let service of services) {
                const type = get_config_from_obj(service, 'type');
                if (type !== null) { %>
            <%- _partial('donate/' + type, { type, service }) %>
            <% }
            } %>
        </div>
    </div>
</div>
<% } %>

<% if (!index && (post.prev || post.next)) { %>
<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        <% if (post.prev){ %>
        <div class="level-start">
            <a class="level level-item has-link-grey <%= !post.prev ? 'is-hidden-mobile' : '' %> article-nav-prev"
                href="<%- url_for(post.prev.path) %>">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item"><%= post.prev.title %></span>
            </a>
        </div>
        <% } %>
        <% if (post.next){ %>
        <div class="level-end">
            <a class="level level-item has-link-grey <%= !post.next ? 'is-hidden-mobile' : '' %> article-nav-next"
                href="<%- url_for(post.next.path) %>">
                <span class="level-item"><%= post.next.title %></span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        <% } %>
    </div>
</div>
<% } %>

<% if (!index && has_config('comment.type')) { %>
<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal"><%= __('article.comments') %></h3>
        <%- _partial('comment/' + get_config('comment.type')) %>
    </div>
</div>
<% } %>

<% friends = [
    {
        nick: '<span style="font-weight:500;">0xfaner</span>', title: '现役ACMer柏老板的博客',
        link: 'https://0xfaner.top/',
        avatar: '/images/friends/0xfaner.jpg'
    },
    {
        nick: '<span style="font-weight:500;">Brethland</span>', title: 'PLT / Mathematics / Literature / Otaku',
        link: 'http://yuki.systems/',
        avatar: '/images/friends/brethland.jpg'
    },
    {
        nick: '<span style="font-weight:500;">matrix72</span>', title: 'matrix72的万事屋',
        link: 'https://www.matrix72.top/',
        avatar: '/images/friends/matrix72.jpg'
    },
    {
        nick: '<span style="font-weight:500;">xjzsq</span>', title: '珂学家的代码日常',
        link: 'https://www.xjdesyxx.top/',
        avatar: '/images/friends/xjzsq.jpg'
    },
    {
        nick: '故心人不见', title: '算法竞赛路上奋斗中的yuhi学长的博客',
        link: 'https://yuhi.xyz/',
        avatar: '/images/friends/yuhi.png'
    },
    {
        nick: '雨落新痕', title: '雨落新痕的博客',
        link: 'http://mashiro.zone/',
        avatar: '/images/friends/yuan.jpg'
    }
]; %>
<% per_row = 3; %>

<% if (post.title == "About") { %>
<div class="card">
    <div class="card-content has-math">
        <h3 class="title is-5 has-text-weight-normal">Friends</h3>
        <% for (let i in friends) { %>
        <% if (!(i % per_row)) { %>
        <div class="tile is-ancestor">
            <% } %>
            <div class="tile is-parent">
                <a href="<%= friends[i].link %>" target="_blank" rel="friend noopener">
                    <article class="tile is-child box">
                        <p class="title rigid"><%- friends[i].nick %></p>
                        <p class="subtitle"><%= friends[i].title %></p>
                        <div class="content">
                            <figure class="image has-mb-6">
                                <img class="image is-rounded" src="<%= friends[i].avatar %>"
                                    alt="<%= friends[i].nick %>" style="width: 128px;" />
                            </figure>
                        </div>
                    </article>
                </a>
            </div>
            <% if (!((i + 1) % per_row)) { %>
        </div>
        <% } %>
        <% } %>
        <% if (friends.length % per_row) { %>
    </div>
    <% } %>
</div>
</div>
<% } %>
<% } %>